<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - app/scripts/controllers/keen.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>app/scripts/controllers/keen.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">63.72</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">125</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">17.67</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.01</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">angular.module(&#039;angularApp&#039;)
    .controller(&#039;KeenCtrl&#039;, [ &#039;$scope&#039;, &#039;$http&#039;, function($scope, $http) {
        var client = new Keen({
            projectId: &quot;561925d196773d74b138cefd&quot;, // String (required always)
            readKey: &quot;363fa49e3c02ebb483fb0dd2f219a9347243c32562720fd877abd34e206a545bb7923dc478beb1f18be28ab3459338b41946d3288768d6e33b8c883c8592cc3b439dc09330b6f7a1f27e1a9c152db2079ede12b53204e91e547350dcf02fdd7abcd671dc0291a68d94f2798639e40a89&quot;,   // String (required for querying data)
            protocol: &quot;https&quot;,                  // String (optional: https | http | auto)
            host: &quot;api.keen.io/3.0&quot;,            // String (optional)
            requestType: &quot;jsonp&quot;                // String (optional: jsonp, xhr, beacon)
        });

        $scope.requestLive = function() {
            console.log(&quot;adff&quot;);
            var url = &#039;http://s-bahn-muenchen.hafas.de/bin/540/query.exe/dny?&amp;look_minx=10744745&amp;look_maxx=12440389&amp;look_miny=47825027&amp;look_maxy=48406811&amp;tpl=trains2json&amp;look_productclass=17&amp;look_json=yes&amp;performLocating=1&amp;look_nv=zugposmode|3|get_ageofreport|yes|get_rtmsgstatus|yes|get_linenumber|no|interval|10000|intervalstep|10000|&amp;unique=1444761619000&amp;&#039;;
$http.get(url).
  then(function(response) {
    // this callback will be called asynchronously
    // when the response is available
    $scope.responseArray = response.data;
 }, function(response) {
    // called asynchronously if an error occurs
    // or server returns response with an error status.
 });
        }

        Keen.ready(function(){
            var interval = &quot;every_minute&quot;
            var timeframe = &quot;hourly&quot;

            var chart = new Keen.Dataviz();
            chart
              .el(document.getElementById(&quot;count&quot;))
              .colors([&quot;#49c5b1&quot;])
              .title(&quot;Meldungen heute&quot;)
              .prepare();

            var query = new Keen.Query(&quot;count&quot;, {
                eventCollection: &quot;notifications_start&quot;,
                timeframe: &quot;this_1_days&quot;
            });

            var req = client.run(query, function(err, res){
              if (err) {
                chart.error(err.message);
              }
              else {
                chart
                  .parseRequest(this)
                  .title(&quot;Meldungen in diesem Monat&quot;)
                  .render();
              }
            });
            setInterval(function() {
                req.refresh();
              }, 1000 * 60 * 15);


            // count reports published on s-bahn-muenchen.de
            var averageDelaysToday = new Keen.Query(&quot;average&quot;, {
                eventCollection: &quot;statistics&quot;,
                targetProperty: &quot;totalNumberOfDelays&quot;
            });
            client.draw(averageDelaysToday, document.getElementById(&quot;averageDelaysToday&quot;), {
                chartType: &quot;metric&quot;,
                title: &quot;Minuten&quot;,
                colors: [&quot;#49c5b1&quot;]
            });

            // statistics from mvv live
            var liveDelays = new Keen.Query(&quot;median&quot;, {
                eventCollection: &quot;statistics&quot;,
                targetProperty: &quot;totalNumberOfDelays&quot;,
                timeframe: &quot;this_2_days&quot;,
                interval: &quot;hourly&quot;,
                timezone: &quot;UTC&quot;
            });

            var liveTrains = new Keen.Query(&quot;median&quot;, {
                eventCollection: &quot;statistics&quot;,
                targetProperty: &quot;totalNumberOfTrains&quot;,
                timeframe: &quot;this_2_days&quot;,
                interval: &quot;hourly&quot;,
                timezone: &quot;UTC&quot;
            });

            viz = new Keen.Dataviz()
            .el(document.getElementById(&#039;liveStatistics&#039;))
            .colors([&quot;#49c5b1&quot;, &quot;#ff0000&quot;])
            .height(300)
            .chartType(&quot;linechart&quot;)
            .chartOptions({
                legend:&#039;bottom&#039;, 
                curveType: &#039;function&#039;,
                chartArea: {
                    width: &#039;85%&#039;,
                    height: &#039;80%&#039;
                }
            })
            .prepare();

            client.run([liveDelays, liveTrains], function(error, response){ // run the queries
                var result1 = response[0].result  // data from first query
                var result2 = response[1].result  // data from second query
                var data = []  // place for combined results
                var i=0

                while (i &lt; result1.length) {

                    data[i]={ // format the data so it can be charted
                        timeframe: result1[i][&quot;timeframe&quot;],
                        value: [
                            { category: &quot;∑ Verspätungen in Minuten&quot;, result: result1[i][&quot;value&quot;] },
                            { category: &quot;∑ Züge&quot;, result: result2[i][&quot;value&quot;] }
                        ]
                    }
                    if (i == result1.length-1) { // chart the data

                       viz
                          .data({result: data})
                          .render();
                    }
                    i++;
                }
            });
        });
    }]);</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
